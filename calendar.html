<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ø¬Ø¯ÙˆÙ„</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --brand:#111827;
      --border:#e5e7eb;
      --shadow:0 8px 20px rgba(0,0,0,.08);
      --radius:16px;
      --green:#16a34a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, Arial;
      background:var(--bg);
      color:var(--text);
    }

    .navbar{
      position:sticky;
      bottom:0;
      background:var(--brand);
      display:flex;
      justify-content:space-around;
      padding:10px;
    }
    .navbar a{
      color:#fff;
      text-decoration:none;
      font-size:13px;
      padding:10px 12px;
      border-radius:12px;
    }
    .navbar a.active{ background:rgba(255,255,255,.18); }

    .container{
      max-width:900px;
      margin:auto;
      padding:16px;
      padding-bottom:90px;
    }

    h1{font-size:22px}
    .sub{font-size:14px;color:var(--muted)}

    .day{
      background:var(--card);
      border-radius:var(--radius);
      padding:14px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
      border:2px solid transparent;
      cursor:pointer;
    }
    .day.today{ border-color:var(--green); }
    .day.locked{ opacity:.9; }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      margin-top:14px;
      box-shadow:var(--shadow);
    }

    .row{
      display:flex;
      justify-content:space-between;
      padding:8px 0;
      border-bottom:1px dashed var(--border);
    }
    .row:last-child{border-bottom:none}
    .label{color:var(--muted)}
    .value{font-weight:700}

    label{display:block;margin-top:12px}
    input, textarea{
      width:100%;
      padding:12px;
      margin-top:6px;
      border-radius:12px;
      border:1px solid var(--border);
    }
    textarea{resize:none}

    .btn{
      width:100%;
      padding:14px;
      margin-top:14px;
      border:none;
      border-radius:14px;
      background:var(--brand);
      color:#fff;
      cursor:pointer;
    }
  </style>
</head>
<body>

<nav class="navbar">
  <a href="stock.html">ğŸ“¦ Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©</a>
  <a href="traders.html">ğŸ§‘â€ğŸ’¼ Ø§Ù„ØªØ¬Ø§Ø±</a>
  <a class="active" href="calendar.html">ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„</a>
</nav>

<div class="container">
  <h1>ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>
  <p class="sub">Ø§Ù„ÙŠÙˆÙ… ÙŠØªØ­ÙØ¸ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ¨Ø¹Ø¯Ù‡Ø§ ÙŠØ¨Ù‚Ù‰ ØªÙ‚Ø±ÙŠØ± Ø«Ø§Ø¨Øª</p>

  <div id="daysList"></div>

  <!-- EDITABLE DAY -->
  <div class="card" id="dayForm" style="display:none">
    <h3 id="formTitle"></h3>

    <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© (ÙƒØ¬Ù…)</label>
    <input type="number" id="soldKg">

    <label>ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙŠÙ„Ùˆ</label>
    <input type="number" id="costKg">

    <label>Ø³Ø¹Ø± Ø¨ÙŠØ¹ Ø§Ù„ÙƒÙŠÙ„Ùˆ</label>
    <input type="number" id="sellKg">

    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
    <textarea id="notes" rows="3"></textarea>

    <div id="profit" style="margin-top:10px;font-weight:bold"></div>

    <button class="btn" onclick="saveDay()">Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ…</button>
  </div>

  <!-- READ ONLY DAY -->
  <div class="card" id="dayDoc" style="display:none">
    <h3 id="docTitle"></h3>

    <div class="row"><span class="label">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</span><span class="value" id="dQty"></span></div>
    <div class="row"><span class="label">ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙŠÙ„Ùˆ</span><span class="value" id="dCost"></span></div>
    <div class="row"><span class="label">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</span><span class="value" id="dSell"></span></div>
    <div class="row"><span class="label">Ø§Ù„Ù…ÙƒØ³Ø¨</span><span class="value" id="dProfit"></span></div>
    <div class="row"><span class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span><span class="value" id="dNotes"></span></div>
  </div>
</div>

<script>
  const daysList = document.getElementById("daysList");
  const dayForm = document.getElementById("dayForm");
  const dayDoc = document.getElementById("dayDoc");

  const soldKg = document.getElementById("soldKg");
  const costKg = document.getElementById("costKg");
  const sellKg = document.getElementById("sellKg");
  const notes = document.getElementById("notes");
  const profitDiv = document.getElementById("profit");

  let calendar = JSON.parse(localStorage.getItem("calendarDays")) || {};
  let activeDate = null;

  const today = new Date();
  today.setHours(0,0,0,0);

  function key(d){ return d.toISOString().split("T")[0]; }

  function renderDays(){
    daysList.innerHTML = "";
    for(let i=0;i<5;i++){
      const d = new Date(today);
      d.setDate(today.getDate()+i);
      const k = key(d);
      const saved = calendar[k];

      daysList.innerHTML += `
        <div class="day ${saved?'locked':''} ${k===key(today)?'today':''}"
             onclick="openDay('${k}')">
          <strong>${d.toLocaleDateString('ar-EG',{weekday:'long',day:'2-digit',month:'2-digit'})}</strong>
          <div style="font-size:13px;color:#6b7280">
            ${saved ? 'ØªÙ‚Ø±ÙŠØ± Ù…Ø­ÙÙˆØ¸' : 'Ù…ÙØªÙˆØ­ Ù„Ù„ØªØ³Ø¬ÙŠÙ„'}
          </div>
        </div>
      `;
    }
  }

  function openDay(k){
    activeDate = k;
    const data = calendar[k];

    dayForm.style.display = "none";
    dayDoc.style.display = "none";

    if(data){
      // DOCUMENT
      dayDoc.style.display = "block";
      document.getElementById("docTitle").textContent = "ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… " + k;
      dQty.textContent = data.soldKg + " ÙƒØ¬Ù…";
      dCost.textContent = data.costKg + " Ø¬Ù†ÙŠÙ‡";
      dSell.textContent = data.sellKg + " Ø¬Ù†ÙŠÙ‡";
      dProfit.textContent = data.profit + " Ø¬Ù†ÙŠÙ‡";
      dNotes.textContent = data.notes || "-";
    }else{
      // FORM
      dayForm.style.display = "block";
      document.getElementById("formTitle").textContent = "ØªØ³Ø¬ÙŠÙ„ ÙŠÙˆÙ… " + k;
      soldKg.value = costKg.value = sellKg.value = notes.value = "";
      profitDiv.textContent = "";
    }
  }

  function calcProfit(){
    const q = +soldKg.value, c = +costKg.value, s = +sellKg.value;
    if(q && c && s){
      const p = (s-c)*q;
      profitDiv.textContent = "ğŸ’° Ø§Ù„Ù…ÙƒØ³Ø¨: " + p + " Ø¬Ù†ÙŠÙ‡";
      profitDiv.style.color = p>=0 ? "#16a34a" : "#dc2626";
      return p;
    }
    profitDiv.textContent = "";
    return null;
  }

  soldKg.oninput = costKg.oninput = sellKg.oninput = calcProfit;

  function saveDay(){
    const profit = calcProfit();
    if(profit===null){ alert("Ø§Ù…Ù„Ø§ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }

    calendar[activeDate] = {
      soldKg:+soldKg.value,
      costKg:+costKg.value,
      sellKg:+sellKg.value,
      profit:profit,
      notes:notes.value,
      locked:true
    };

    localStorage.setItem("calendarDays", JSON.stringify(calendar));
    renderDays();
    openDay(activeDate);
  }

  renderDays();
</script>

</body>
</html>
